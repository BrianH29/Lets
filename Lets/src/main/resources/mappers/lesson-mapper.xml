<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="lessonMapper">
	
<resultMap id="lessonResultSet" type="Lesson">
	<id column="lesson_no" property="lessonNo" />
	<result column="mem_no" property="memNo" />
	<result column="lesson_form" property="lessonForm" />
	<result column="lesson_type" property="lessonType" />
	<result column="lesson_group" property="lessonGroup" />
	<result column="lesson_category" property="lessonCategory" />
	<result column="lesson_title" property="lessonTitle" />
	<result column="lesson_cover_img" property="lessonCoverImg" />
	<result column="lesson_instr" property="lessonInstr" jdbcType="CLOB" javaType="java.lang.String" />
	<result column="lesson_cont_no" property="lessonContNo" />
	<result column="lesson_prepare" property="lessonPrepare" />
	<result column="lesson_target" property="lessonTarget" />
	<result column="like_count" property="likeCount" />
	<result column="lesson_status" property="lessonStatus" />
	<result column="status_hold" property="statusHold" />
	<result column="h_reason" property="holdReason" />
	<result column="r_reason" property="refuseReason" />
	<result column="price" property="price" />
	<result column="time" property="time" />
	<result column="total_count" property="totalCount" />
	<result column="period" property="period" />
	<result column="disc_status" property="discStatus" />
	<result column="discount_period" property="discountPeriod" />
	<result column="discount" property="discount" />
	<result column="pay_total" property="payTotal" />
	<result column="status" property="status" />
	<result column="approve_date" property="approveDate" />
</resultMap>

<resultMap id="reviewResultSet" type="Review">
	<id column="review_no" property="reviewNo" />
	<result column="lesson_no" property="lessonNo" />
	<result column="mem_no" property="memNo" />
	<result column="star" property="star" />
	<result column="review_content" property="reviewContent"/>
	<result column="enroll_date" property="reviewEnrollDate"/>
	<result column="modify_date" property="reviewModifyDate"/>
	<result column="status" property="status"/> 
	<result column="nickname" property="nickname"/> 
	<result column="mem_pic" property="memPic"/> 
</resultMap>

<resultMap id="lessonFaqResultSet" type="LessonFaq">
	<result column="lesson_no" property="lessonNo"/>
	<result column="faq_question" property="faqQuestion" />
	<result column="faq_answer" property="faqAnswer" />
</resultMap>

<resultMap id="tutorResultSet" type="Tutor">
	<result column="mem_no" property="memNo" />
	<result column="tutor_pic" property="tutorPic" />
	<result column="tutor_info" property="tutorInfo"/>
	<result column="modify_date" property="modifyDate" />
	<result column="status" property="status" />
</resultMap>

<resultMap id="replyResultSet" type="Reply">
	<id column="reply_no" property="replyNo" />
	<result column="reply_content" property="replyContent"/>
	<result column="reply_level" property="replyLevel"/>
	<result column="replyDate" property="replyEnrollDate" />
	<result column="modify_Date" property="replyModifyDate" />
	<result column="total_no" property="totalNo"/>
	<result column="reply_type" property="replyType"/>
	<result column="nickname" property="nickname" />
</resultMap>

<select id="selectApproveLessonList" resultMap="lessonResultSet" >
	select
	       lesson_no
	     , lesson_title
	     , approve_date
	     , lesson_type
	  from lesson
	 order
	    by approve_date desc
</select>

<select id="selectApproveStatusList" resultMap="lessonResultSet" >
	select
	       lesson_no
	     , lesson_title
	     , approve_date
	     , lesson_type
         , h_reason
         , r_reason
         , lesson_status
	  from lesson
	 where status='Y'
	 order
	    by approve_date desc
</select>

<select id="selectReview" parameterType="_int" resultMap="reviewResultSet">
	<![CDATA[select * 
			   from 
					(
					select 
						   r.review_no
					     , r.star
					     , r.review_content
					     , r.enroll_date
					     , m.nickname
					     , m.mem_pic
					  from review r
					  join member m 
					    on(r.mem_no=m.mem_no)
					 where r.lesson_no = #{lessonNo} 
					   and r.status = 'Y'
					 order
					    by r.enroll_date desc
					    )
			  where rownum < 6]]> 
</select>

<select id="selectLessonFaqList" parameterType="_int" resultMap="lessonFaqResultSet">
	select *
	  from lesson_faq
	 where lesson_no = #{lessonNo}
</select>

<select id="selectTutorInfo" parameterType="_int" resultMap="tutorResultSet">
	select
	       t.mem_no
	     , t.tutor_pic
	     , t.tutor_info
	     , t.status
	     , m.nickname
	  from tutor t
	  join member m on (t.mem_no=m.mem_no)
	  join lesson l on (t.mem_no=l.mem_no)
	 where t.status='Y'
	   and l.lesson_no = #{lessonNo}
</select>

<update id="deleteLesson" parameterType="_int">
	 update
	        lesson
	    set status='N'
	  where lesson_no = #{lno}
</update>

<select id="selectListCount" resultType="_int">
	select
	       count(*)
	  from reply
	 where reply_type = '클래스'
	   and reply_level = 1
	   and status = 'Y'
</select>

<select id="selectReply" resultMap="replyResultSet">
	select
	       r.reply_no
	     , r.mem_no
	     , r.reply_content
	     , r.enroll_date
	     , r.reply_level
	     , m.nickname
	     , m.mem_pic
	  from reply r
	  join member m on(r.mem_no = m.mem_no)
	 where reply_type = '클래스'
	   and total_no = #{lessonNo}
</select>

</mapper>